(function(e){var t=e(window);var n={};var r=[];var i=[];var s=false;var o=false;var u;var a=null;var f=null;var l=null;var c=null;var h="_open";var p="_close";var d=null;var v={_init:function(t){var n=e(t);var s=n.data("popupoptions");i[t.id]=false;r[t.id]=0;if(!n.data("popup-initialized")){n.attr("data-popup-initialized","true");v._initonce(t)}if(s.autoopen){setTimeout(function(){v.show(t,0)},0)}},_initonce:function(t){var n=e("body");var r;var i=$el.data("popupoptions");c=parseInt(n.css("margin-right"),10);if(i.type=="tooltip"){i.background=false;i.scrolllock=false}if(i.scrolllock){var s;var o;if(typeof u==="undefined"){s=e('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");o=s.children();u=o.innerWidth()-o.height(99).innerWidth();s.remove()}}if(!$el.attr("id")){$el.attr("id","j-popup-"+parseInt(Math.random()*1e8))}$el.addClass("popup_content");n.prepend(t);$el.wrap('<div id="'+t.id+'_wrapper" class="popup_wrapper" />');r=e("#"+t.id+"_wrapper");r.css({opacity:0,visibility:"hidden",position:"absolute",overflow:"auto"});$el.css({opacity:0,visibility:"hidden",display:"inline-block"});if(i.setzindex&&!i.autozindex){r.css("z-index","2001")}if(!i.outline){$el.css("outline","none")}if(i.transition){$el.css("transition",i.transition);r.css("transition",i.transition)}e(t).attr("aria-hidden",true);if(i.background&&!e("#"+t.id+"_background").length){var a='<div id="'+t.id+'_background" class="popup_background"></div>';n.prepend(a);var f=e("#"+t.id+"_background");f.css({opacity:0,visibility:"hidden",backgroundColor:i.color,position:"fixed",top:0,right:0,bottom:0,left:0});if(i.setzindex&&!i.autozindex){f.css("z-index","2000")}if(i.transition){f.css("transition",i.transition)}}if(i.type=="overlay"){$el.css({textAlign:"left",position:"relative",verticalAlign:"middle"});r.css({position:"fixed",top:0,right:0,left:0,bottom:0,textAlign:"center"});r.append('<div class="popup_align" />');e(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})}$el.attr("role","dialog");var l=i.openelement?i.openelement:"."+t.id+h;e(l).each(function(t,n){e(n).attr("data-popup-ordinal",t);if(!e(n).attr("id")){e(n).attr("id","open_"+parseInt(Math.random()*1e8,10))}});if(!($el.attr("aria-labelledby")||$el.attr("aria-label"))){$el.attr("aria-labelledby",e(l).attr("id"))}e(document).on("click",l,function(n){if(!$el.data("popup-visible")){var r=e(this).data("popup-ordinal");setTimeout(function(){v.show(t,r)},0);n.preventDefault()}});var d=i.closeelement?i.closeelement:"."+t.id+p;e(document).on("click",d,function(e){v.hide(t);e.preventDefault()});if(i.detach){$el.hide().detach()}else{r.hide()}},show:function(n,h){var p=e(n);if(p.data("popup-visible"))return;if(!p.data("popup-initialized")){v._init(n)}p.attr("data-popup-initialized","true");var g=e("body");var y=p.data("popupoptions");var b=e("#"+n.id+"_wrapper");var w=e("#"+n.id+"_background");m(n,h,y.beforeopen);i[n.id]=h;if(y.detach){b.prepend(n);p.show()}else{b.show()}setTimeout(function(){b.css({visibility:"visible",opacity:1});e("html").addClass("popup_visible").addClass("popup_visible_"+n.id);p.addClass("popup_content_visible")},20);p.css({visibility:"visible",opacity:1});if(y.scrolllock){g.css("overflow","hidden");if(g.height()>t.height()){g.css("margin-right",c+u)}}setTimeout(function(){if(!s){if(y.keepfocus){e(document).on("focusin",a)}if(y.blur){e(document).on("click",f)}if(y.escape){e(document).on("keydown",l)}}if(!s){s=true}else{o=true}},0);p.data("popup-visible",true);v.reposition(n,h);if(y.background){w.css({visibility:"visible",opacity:y.opacity});setTimeout(function(){w.css({opacity:y.opacity})},0)}d=document.activeElement;if(y.keepfocus){p.attr("tabindex",-1);setTimeout(function(){if(y.focuselement){e(y.focuselement).focus()}else{p.focus()}},y.focusdelay);a=function(e){var t=document.getElementById(n.id);if(!t.contains(e.target)){e.stopPropagation();t.focus()}}}if(y.autozindex){var E=document.getElementsByTagName("*");var S=E.length;var x=0;for(var T=0;T<S;T++){var N=e(E[T]).css("z-index");if(N!=="auto"){N=parseInt(N);if(x<N){x=N}}}r[n.id]=x;if(r[n.id]>0){b.css({zIndex:r[n.id]+2})}if(y.background){if(r[n.id]>0){e("#"+n.id+"_background").css({zIndex:r[n.id]+1})}}}if(y.blur){f=function(t){if(!e(t.target).parents().andSelf().is("#"+n.id)){v.hide(n)}}}if(y.escape){l=function(e){if(e.keyCode==27&&p.data("popup-visible")){v.hide(n)}}}e(y.pagecontainer).attr("aria-hidden",true);p.attr("aria-hidden",false);b.one("transitionend",function(){m(n,h,y.opentransitionend)});m(n,h,y.onopen)},hide:function(t){var n=e("body");var r=e(t);var u=r.data("popupoptions");var h=e("#"+t.id+"_wrapper");var p=e("#"+t.id+"_background");r.data("popup-visible",false);if(o){e("html").removeClass("popup_visible_"+t.id);o=false}else{e("html").removeClass("popup_visible").removeClass("popup_visible_"+t.id);s=false}r.removeClass("popup_content_visible");if(u.scrolllock){setTimeout(function(){n.css({overflow:"visible","margin-right":c})},10)}if(u.blur){e(document).off("click",f)}if(u.keepfocus){e(document).off("focusin",a);setTimeout(function(){if(e(d).is(":visible")){d.focus()}},0)}if(u.escape){e(document).off("keydown",l)}h.css({visibility:"hidden",opacity:0});r.css({visibility:"hidden",opacity:0});if(u.background){p.css({visibility:"hidden",opacity:0})}r.one("transitionend",function(e){if(!r.data("popup-visible")){if(u.detach){r.hide().detach()}else{h.hide()}}if(!u.notransitiondetach){m(t,i[t.id],u.closetransitionend)}});if(u.notransitiondetach){if(u.detach){r.hide().detach()}else{h.hide()}}e(u.pagecontainer).attr("aria-hidden",false);r.attr("aria-hidden",true);m(t,i[t.id],u.onclose)},toggle:function(e,t){if($el.data("popup-visible")){v.hide(e)}else{setTimeout(function(){v.show(e,t)},0)}},reposition:function(t,n){var r=e(t);var i=r.data("popupoptions");var s=e("#"+t.id+"_wrapper");var o=e("#"+t.id+"_background");n=n||0;if(i.type=="tooltip"){s.css({position:"absolute"});var u=i.openelement?i.openelement:"."+t.id+h;var a=e(u+'[data-popup-ordinal="'+n+'"]');var f=a.offset();if(i.horizontal=="right"){s.css("left",f.left+a.outerWidth()+i.offsetleft)}else if(i.horizontal=="leftedge"){s.css("left",f.left+a.outerWidth()-a.outerWidth()+i.offsetleft)}else if(i.horizontal=="left"){s.css("right",e(window).width()-f.left-i.offsetleft)}else if(i.horizontal=="rightedge"){s.css("right",e(window).width()-f.left-a.outerWidth()-i.offsetleft)}else{s.css("left",f.left+a.outerWidth()/2-r.outerWidth()/2-parseFloat(r.css("marginLeft"))+i.offsetleft)}if(i.vertical=="bottom"){s.css("top",f.top+a.outerHeight()+i.offsettop)}else if(i.vertical=="bottomedge"){s.css("top",f.top+a.outerHeight()-r.outerHeight()+i.offsettop)}else if(i.vertical=="top"){s.css("bottom",e(window).height()-f.top-i.offsettop)}else if(i.vertical=="topedge"){s.css("bottom",e(window).height()-f.top-r.outerHeight()-i.offsettop)}else{s.css("top",f.top+a.outerHeight()/2-r.outerHeight()/2-parseFloat(r.css("marginTop"))+i.offsettop)}}else if(i.type=="overlay"){if(i.horizontal){s.css("text-align",i.horizontal)}else{s.css("text-align","center")}if(i.vertical){r.css("vertical-align",i.vertical)}else{r.css("vertical-align","middle")}}}};var m=function(t,r,i){var s=n.openelement?n.openelement:"."+t.id+h;var o=e(s+'[data-popup-ordinal="'+r+'"]');if(typeof i=="function"){i(o)}};e.fn.popup=function(t){return this.each(function(){$el=e(this);if(typeof t==="object"){var r=e.extend({},e.fn.popup.defaults,t);$el.data("popupoptions",r);n=$el.data("popupoptions");v._init(this)}else if(typeof t==="string"){if(!$el.data("popupoptions")){$el.data("popupoptions",e.fn.popup.defaults);n=$el.data("popupoptions")}v[t].call(this,this)}else{if(!$el.data("popupoptions")){$el.data("popupoptions",e.fn.popup.defaults);n=$el.data("popupoptions")}v._init(this)}})};e.fn.popup.defaults={type:"overlay",autoopen:false,background:true,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:true,blur:true,setzindex:true,autozindex:false,scrolllock:false,keepfocus:true,focuselement:null,focusdelay:50,outline:false,pagecontainer:null,detach:false,openelement:null,closeelement:null,transition:null,notransitiondetach:false,beforeopen:function(){},onclose:function(){},onopen:function(){},opentransitionend:function(){},closetransitionend:function(){}}})(jQuery)